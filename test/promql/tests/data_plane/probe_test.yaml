evaluation_interval: 1m

rule_files:
  - prometheus.probe_alerts.yaml

tests:

  - interval: 1m
    input_series:
      - series: probe_success{job="web-server",instance="instance01",target="target01",source_cluster="cluster01"}
        values: 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0

    alert_rule_test:
      - eval_time: 36m
        alertname: ProbeAlert
        exp_alerts:
          - exp_labels:
              severity: high
              instance: instance01
              job: web-server
              target: target01
              source_cluster: cluster01
            exp_annotations:
              description: 'Probe alert instance instance01 with job web-server and target target01 for cluster cluster01.'
              summary: Probe alert web-server.
              alert_routing_key: spreandinfra
              slo: 'false'

  - interval: 1m
    input_series:
      - series: probe_success{job="s390x-static-host",instance="instance01",target="s390x-host01",source_cluster="cluster01"}
        values: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
      - series: probe_success{job="s390x-static-host",instance="instance02",target="s390x-host02",source_cluster="cluster01"}
        values: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

    alert_rule_test:
      - eval_time: 36m
        alertname: S390xStaticHostProbeAlert
        exp_alerts:
          - exp_labels:
              severity: high
              source_cluster: cluster01
              job: s390x-static-host
            exp_annotations:
              description: 'Probe alert with job s390x-static-host for cluster cluster01.'
              summary: Infra S390x Static Host Probe alert s390x-static-host.
              alert_routing_key: spreandinfra
              slo: 'false'

  - interval: 1m
    input_series:
      - series: probe_success{job="ppc-static-host",instance="instance01",target="ppc-host01",source_cluster="cluster01"}
        values: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
      - series: probe_success{job="ppc-static-host",instance="instance02",target="ppc-host02",source_cluster="cluster01"}
        values: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

    alert_rule_test:
      - eval_time: 35m
        alertname: PPCStaticHostProbeAlert
        exp_alerts:
          - exp_labels:
              severity: high
              source_cluster: cluster01
              job: ppc-static-host
            exp_annotations:
              description: 'Probe alert with job ppc-static-host for cluster cluster01.'
              summary: Infra PPC Static Host Probe alert ppc-static-host.
              alert_routing_key: spreandinfra
              slo: 'false'

  - interval: 1m
    input_series:
      - series: probe_success{job="vpn",instance="instance01",target="vpn01",source_cluster="cluster01"}
        values: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
      - series: probe_success{job="vpn",instance="instance02",target="vpn01",source_cluster="cluster01"}
        values: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

    alert_rule_test:
      - eval_time: 35m
        alertname: VPNProbeAlert
        exp_alerts:
          - exp_labels:
              severity: high
              source_cluster: cluster01
              target: vpn01
              job: vpn
            exp_annotations:
              description: 'Probe alert with job vpn and target vpn01 for cluster cluster01.'
              summary: VPN Probe alert vpn.
              alert_routing_key: spreandinfra
              slo: 'false'
